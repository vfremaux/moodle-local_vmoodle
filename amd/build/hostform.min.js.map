{"version":3,"sources":["../src/hostform.js"],"names":["define","$","cfg","log","init","bind","syncSchema","opencnxpopup","opendatapathpopup","switcherservices","debug","dbtype","val","dbhost","dblogin","dbpass","dbname","url","wwwroot","encodeURIComponent","windowobj","window","open","document","title","datapath","escape","that","mnetnewsubnetwork","attr","multimnet","services","originelement","syncedelement2","syncedelement3","syncedelement4","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint unused: true, undef:true\n// eslint \n\ndefine(['jquery', 'core/config', 'core/log'], function($, cfg, log) {\n\n    var hostform = {\n\n        init: function() {\n            $(\"#id_shortname\").bind('change', this.syncSchema);\n            $(\"#id_testconnection\").bind('click', this.opencnxpopup);\n            $(\"#id_testdatapath\").bind('click', this.opendatapathpopup);\n            $(\"#id_mnet\").bind('click', this.switcherservices);\n            log.debug(\"AMD VMoodle Hostform initialized\");\n        },\n\n        /*\n         * Pop-up testing connection with database.\n         * TODO : Make this test request more network secure.\n         * Solution 1 : Remove GET params, fetch parent window form elements\n         * values and fire POST form\n         * solution 2 : Obfuscate query string into simply crypted bundle\n         */\n        // jshint undef:false, unused:false\n        opencnxpopup: function() {\n\n            // Input data.\n            var dbtype = $('#id_vdbtype').val();\n            var dbhost = $('#id_vdbhost').val();\n            var dblogin = $('#id_vdblogin').val();\n            var dbpass = $('#id_vdbpass').val();\n            var dbname = $('#id_vdbname').val();\n\n            // PHP file linked the pop-up, and name.\n            var url = cfg.wwwroot + \"/local/vmoodle/views/management.testcnx.php?\";\n            url += \"vdbtype=\" + dbtype;\n            url += '&vdbhost=' + encodeURIComponent(dbhost);\n            url += '&vdblogin=' + encodeURIComponent(dblogin);\n            url += '&vdbpass=' + encodeURIComponent(dbpass);\n            url += '&vdbname=' + encodeURIComponent(dbname);\n\n            // Pop-up's options.\n            var options = \"width=500,height=300,toolbar=no,menubar=no,location=no,scrollbars=no,status=no\";\n\n            // Opening the pop-up (title not working in Firefox).\n            var windowobj = window.open(url, '', options);\n            // Needed to be valid in IE.\n            windowobj.document.title = \"Vmoodle connexion test\";\n        },\n\n        /**\n         * Pop-up testing connection with database.\n         */\n        opendatapathpopup: function () {\n\n            // Input data.\n            var datapath = $('#id_vdatapath').val();\n\n            // PHP file linked the pop-up, and name.\n            var url = cfg.wwwroot + \"/local/vmoodle/views/management.testdatapath.php?\";\n            url += 'dataroot=' + escape(datapath);\n\n            // Pop-up's options.\n            var options = \"width=500,height=300,toolbar=no,menubar=no,location=no,scrollbars=no,status=no\";\n\n            // Opening the pop-up (title not working in Firefox).\n            var windowobj = window.open(url, '', options);\n            // Needed to be valid in IE.\n            windowobj.document.title = \"VMoodle test data path\";\n        },\n\n        /**\n         * Activates/desactivates services selection.\n         */\n        switcherservices: function () {\n\n            var that = $(this);\n            var mnetnewsubnetwork = that.attr('data-subnet');\n\n            // Retrieve 'select' elements from form.\n            var multimnet = $('#id_multimnet');\n            var services = $('#id_services');\n\n            // Default values for services.\n            var mnetfreedefault = '0';\n            var defaultservices = 'default';\n            var subnetworkservices = 'subnetwork';\n\n            // Do the actions.\n            if (multimnet.val() === mnetfreedefault\n                    || multimnet.val() === mnetnewsubnetwork) {\n                services.val(defaultservices);\n                services.attr('disabled', true);\n            } else {\n                services.attr('disabled', false);\n                services.val(subnetworkservices);\n            }\n        },\n\n        syncSchema: function() {\n\n            var originelement = $(\"#id_shortname\");\n\n            var syncedelement2 = $(\"#id_vdbname\");\n            var syncedelement3 = $(\"#id_vdatapath\");\n            var syncedelement4 = $(\"#id_vhostname\");\n\n            originelement.val(originelement.val().replace(/-/g, '_'));\n            originelement.val(originelement.val().replace(/ /g, '_'));\n            syncedelement2.val(syncedelement2.val().replace(/<%%INSTANCE%%>/g, originelement.val()));\n            syncedelement3.val(syncedelement3.val().replace(/<%%INSTANCE%%>/g, originelement.val()));\n            syncedelement4.val(syncedelement4.val().replace(/<%%INSTANCE%%>/g, originelement.val()));\n        }\n\n    };\n\n    return hostform;\n});\n"],"file":"hostform.min.js"}