{"version":3,"file":"hostform.min.js","sources":["../src/hostform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint unused: true, undef:true\n// eslint \n\ndefine(['jquery', 'core/config', 'core/log'], function($, cfg, log) {\n\n    var hostform = {\n\n        init: function() {\n            $(\"#id_shortname\").bind('change', this.syncSchema);\n            $(\"#id_testconnection\").bind('click', this.opencnxpopup);\n            $(\"#id_testdatapath\").bind('click', this.opendatapathpopup);\n            $(\"#id_mnet\").bind('click', this.switcherservices);\n            log.debug(\"AMD VMoodle Hostform initialized\");\n        },\n\n        /*\n         * Pop-up testing connection with database.\n         * TODO : Make this test request more network secure.\n         * Solution 1 : Remove GET params, fetch parent window form elements\n         * values and fire POST form\n         * solution 2 : Obfuscate query string into simply crypted bundle\n         */\n        // jshint undef:false, unused:false\n        opencnxpopup: function() {\n\n            // Input data.\n            var dbtype = $('#id_vdbtype').val();\n            var dbhost = $('#id_vdbhost').val();\n            var dblogin = $('#id_vdblogin').val();\n            var dbpass = $('#id_vdbpass').val();\n            var dbname = $('#id_vdbname').val();\n\n            // PHP file linked the pop-up, and name.\n            var url = cfg.wwwroot + \"/local/vmoodle/views/management.testcnx.php?\";\n            url += \"vdbtype=\" + dbtype;\n            url += '&vdbhost=' + encodeURIComponent(dbhost);\n            url += '&vdblogin=' + encodeURIComponent(dblogin);\n            url += '&vdbpass=' + encodeURIComponent(dbpass);\n            url += '&vdbname=' + encodeURIComponent(dbname);\n\n            // Pop-up's options.\n            var options = \"width=500,height=300,toolbar=no,menubar=no,location=no,scrollbars=no,status=no\";\n\n            // Opening the pop-up (title not working in Firefox).\n            var windowobj = window.open(url, '', options);\n            // Needed to be valid in IE.\n            windowobj.document.title = \"Vmoodle connexion test\";\n        },\n\n        /**\n         * Pop-up testing connection with database.\n         */\n        opendatapathpopup: function () {\n\n            // Input data.\n            var datapath = $('#id_vdatapath').val();\n\n            // PHP file linked the pop-up, and name.\n            var url = cfg.wwwroot + \"/local/vmoodle/views/management.testdatapath.php?\";\n            url += 'dataroot=' + escape(datapath);\n\n            // Pop-up's options.\n            var options = \"width=500,height=300,toolbar=no,menubar=no,location=no,scrollbars=no,status=no\";\n\n            // Opening the pop-up (title not working in Firefox).\n            var windowobj = window.open(url, '', options);\n            // Needed to be valid in IE.\n            windowobj.document.title = \"VMoodle test data path\";\n        },\n\n        /**\n         * Activates/desactivates services selection.\n         */\n        switcherservices: function () {\n\n            var that = $(this);\n            var mnetnewsubnetwork = that.attr('data-subnet');\n\n            // Retrieve 'select' elements from form.\n            var multimnet = $('#id_multimnet');\n            var services = $('#id_services');\n\n            // Default values for services.\n            var mnetfreedefault = '0';\n            var defaultservices = 'default';\n            var subnetworkservices = 'subnetwork';\n\n            // Do the actions.\n            if (multimnet.val() === mnetfreedefault\n                    || multimnet.val() === mnetnewsubnetwork) {\n                services.val(defaultservices);\n                services.attr('disabled', true);\n            } else {\n                services.attr('disabled', false);\n                services.val(subnetworkservices);\n            }\n        },\n\n        syncSchema: function() {\n\n            var originelement = $(\"#id_shortname\");\n\n            var syncedelement2 = $(\"#id_vdbname\");\n            var syncedelement3 = $(\"#id_vdatapath\");\n            var syncedelement4 = $(\"#id_vhostname\");\n\n            originelement.val(originelement.val().replace(/-/g, '_'));\n            originelement.val(originelement.val().replace(/ /g, '_'));\n            syncedelement2.val(syncedelement2.val().replace(/<%%INSTANCE%%>/g, originelement.val()));\n            syncedelement3.val(syncedelement3.val().replace(/<%%INSTANCE%%>/g, originelement.val()));\n            syncedelement4.val(syncedelement4.val().replace(/<%%INSTANCE%%>/g, originelement.val()));\n        }\n\n    };\n\n    return hostform;\n});\n"],"names":["define","$","cfg","log","init","bind","this","syncSchema","opencnxpopup","opendatapathpopup","switcherservices","debug","dbtype","val","dbhost","dblogin","dbpass","dbname","url","wwwroot","encodeURIComponent","window","open","document","title","datapath","escape","mnetnewsubnetwork","attr","multimnet","services","originelement","syncedelement2","syncedelement3","syncedelement4","replace"],"mappings":"AAkBAA,gCAAO,CAAC,SAAU,cAAe,aAAa,SAASC,EAAGC,IAAKC,WAE5C,CAEXC,KAAM,WACFH,EAAE,iBAAiBI,KAAK,SAAUC,KAAKC,YACvCN,EAAE,sBAAsBI,KAAK,QAASC,KAAKE,cAC3CP,EAAE,oBAAoBI,KAAK,QAASC,KAAKG,mBACzCR,EAAE,YAAYI,KAAK,QAASC,KAAKI,kBACjCP,IAAIQ,MAAM,qCAWdH,aAAc,eAGNI,OAASX,EAAE,eAAeY,MAC1BC,OAASb,EAAE,eAAeY,MAC1BE,QAAUd,EAAE,gBAAgBY,MAC5BG,OAASf,EAAE,eAAeY,MAC1BI,OAAShB,EAAE,eAAeY,MAG1BK,IAAMhB,IAAIiB,QAAU,+CACxBD,KAAO,WAAaN,OACpBM,KAAO,YAAcE,mBAAmBN,QACxCI,KAAO,aAAeE,mBAAmBL,SACzCG,KAAO,YAAcE,mBAAmBJ,QACxCE,KAAO,YAAcE,mBAAmBH,QAMxBI,OAAOC,KAAKJ,IAAK,GAHnB,kFAKJK,SAASC,MAAQ,0BAM/Bf,kBAAmB,eAGXgB,SAAWxB,EAAE,iBAAiBY,MAG9BK,IAAMhB,IAAIiB,QAAU,oDACxBD,KAAO,YAAcQ,OAAOD,UAMZJ,OAAOC,KAAKJ,IAAK,GAHnB,kFAKJK,SAASC,MAAQ,0BAM/Bd,iBAAkB,eAGViB,kBADO1B,EAAEK,MACgBsB,KAAK,eAG9BC,UAAY5B,EAAE,iBACd6B,SAAW7B,EAAE,gBAGK,MAKlB4B,UAAUhB,OACHgB,UAAUhB,QAAUc,mBAC3BG,SAASjB,IANS,WAOlBiB,SAASF,KAAK,YAAY,KAE1BE,SAASF,KAAK,YAAY,GAC1BE,SAASjB,IATY,gBAa7BN,WAAY,eAEJwB,cAAgB9B,EAAE,iBAElB+B,eAAiB/B,EAAE,eACnBgC,eAAiBhC,EAAE,iBACnBiC,eAAiBjC,EAAE,iBAEvB8B,cAAclB,IAAIkB,cAAclB,MAAMsB,QAAQ,KAAM,MACpDJ,cAAclB,IAAIkB,cAAclB,MAAMsB,QAAQ,KAAM,MACpDH,eAAenB,IAAImB,eAAenB,MAAMsB,QAAQ,kBAAmBJ,cAAclB,QACjFoB,eAAepB,IAAIoB,eAAepB,MAAMsB,QAAQ,kBAAmBJ,cAAclB,QACjFqB,eAAerB,IAAIqB,eAAerB,MAAMsB,QAAQ,kBAAmBJ,cAAclB"}